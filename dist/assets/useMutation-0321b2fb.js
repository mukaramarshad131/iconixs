import{a9 as r,aa as t,ab as n,ac as e,ad as o,ae as u}from"./index-a09fe141.js";import{u as a,v as i,D as c}from"./query-8c0888dc.js";var l=r?t.useLayoutEffect:t.useEffect;function s(r,s){var d=a(null==s?void 0:s.client);i(r,c.Mutation);var v=t.useState({called:!1,loading:!1,client:d}),f=v[0],m=v[1],g=t.useRef({result:f,mutationId:0,isMounted:!0,client:d,mutation:r,options:s});l((function(){Object.assign(g.current,{client:d,options:s,mutation:r})}));var p=t.useCallback((function(r){void 0===r&&(r={});var t=g.current,a=t.options,i=t.mutation,c=n(n({},a),{mutation:i}),l=r.client||g.current.client;g.current.result.loading||c.ignoreResults||!g.current.isMounted||m(g.current.result={loading:!0,error:void 0,data:void 0,called:!0,client:l});var s=++g.current.mutationId,d=e(c,r);return l.mutate(d).then((function(t){var n,e,a=t.data,i=t.errors,c=i&&i.length>0?new o({graphQLErrors:i}):void 0,v=r.onError||(null===(n=g.current.options)||void 0===n?void 0:n.onError);if(c&&v&&v(c,d),s===g.current.mutationId&&!d.ignoreResults){var f={called:!0,loading:!1,data:a,error:c,client:l};g.current.isMounted&&!u(g.current.result,f)&&m(g.current.result=f)}var p=r.onCompleted||(null===(e=g.current.options)||void 0===e?void 0:e.onCompleted);return c||null==p||p(t.data,d),t})).catch((function(t){var n;if(s===g.current.mutationId&&g.current.isMounted){var e={loading:!1,error:t,data:void 0,called:!0,client:l};u(g.current.result,e)||m(g.current.result=e)}var o=r.onError||(null===(n=g.current.options)||void 0===n?void 0:n.onError);if(o)return o(t,d),{data:void 0,errors:t};throw t}))}),[]),M=t.useCallback((function(){if(g.current.isMounted){var r={called:!1,loading:!1,client:g.current.client};Object.assign(g.current,{mutationId:0,result:r}),m(r)}}),[]);return t.useEffect((function(){var r=g.current;return r.isMounted=!0,function(){r.isMounted=!1}}),[]),[p,n({reset:M},f)]}export{s as u};
